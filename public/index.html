<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro PDF Compressor</title>
    <style>
        /* CSS Reset & Variabel */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        :root {
            --primary: #3b82f6; --primary-hover: #2563eb;
            --bg: #f8fafc; --surface: #ffffff; --surface-alt: #f1f5f9;
            --text-main: #334155; --text-muted: #64748b;
            --border: #cbd5e1; --danger: #ef4444;
        }

        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            background-color: var(--bg); 
            color: var(--text-main); 
            padding: 2rem; 
            display: flex;
            justify-content: center;
        }

        .app-container { 
            width: 100%; 
            max-width: 800px; 
            background: var(--surface); 
            border-radius: 16px; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.05); 
            overflow: hidden; 
        }

        .header { background: #0f172a; color: white; padding: 1.5rem 2rem; text-align: center; }
        .header h1 { font-size: 1.5rem; font-weight: 600; }
        .content { padding: 2rem; }

        .settings-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 2rem; }
        @media (max-width: 600px) { .settings-grid { grid-template-columns: 1fr; } }

        .setting-group { background: var(--surface-alt); padding: 1.25rem; border-radius: 8px; }
        .setting-group h3 { font-size: 0.875rem; text-transform: uppercase; color: var(--text-muted); margin-bottom: 1rem; letter-spacing: 0.05em; }

        .radio-group { display: flex; gap: 1rem; flex-wrap: wrap; }
        .radio-label { display: flex; align-items: center; gap: 0.5rem; cursor: pointer; font-size: 0.95rem; }
        
        input[type="number"] { width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: 6px; font-size: 1rem; outline: none; }
        input[type="number"]:focus { border-color: var(--primary); }

        .dropzone { border: 2px dashed var(--border); border-radius: 12px; padding: 3rem 2rem; text-align: center; cursor: pointer; transition: all 0.2s; background: var(--bg); margin-bottom: 2rem; }
        .dropzone.dragover { border-color: var(--primary); background: #eff6ff; }
        .dropzone svg { width: 48px; height: 48px; fill: var(--text-muted); margin-bottom: 1rem; }
        
        .file-list { margin-bottom: 2rem; }
        .file-item { display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: var(--surface-alt); border-radius: 8px; margin-bottom: 0.5rem; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .file-info { display: flex; flex-direction: column; gap: 0.25rem; overflow: hidden; }
        .file-name { font-weight: 500; font-size: 0.95rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .file-size { font-size: 0.8rem; color: var(--text-muted); }
        
        .remove-btn { color: var(--danger); background: none; border: none; cursor: pointer; font-weight: 600; padding: 0.5rem; }

        .compress-btn { width: 100%; background: var(--primary); color: white; border: none; padding: 1rem; font-size: 1.1rem; font-weight: 600; border-radius: 8px; cursor: pointer; transition: background 0.2s; }
        .compress-btn:hover:not(:disabled) { background: var(--primary-hover); }
        .compress-btn:disabled { background: var(--border); cursor: not-allowed; }
    </style>
</head>
<body>

    <div class="app-container">
        <div class="header">
            <h1>Pro PDF Compressor</h1>
        </div>
        <div class="content">
            <div class="settings-grid">
                <div class="setting-group">
                    <h3>Tingkat Kompresi</h3>
                    <div class="radio-group">
                        <label class="radio-label"><input type="radio" name="level" value="low"> Low</label>
                        <label class="radio-label"><input type="radio" name="level" value="medium" checked> Medium</label>
                        <label class="radio-label"><input type="radio" name="level" value="ultra"> Ultra</label>
                    </div>
                </div>
                <div class="setting-group">
                    <h3>Target Maksimal (Opsional)</h3>
                    <input type="number" id="maxMb" placeholder="Contoh: 5 MB" min="1" step="0.1">
                </div>
            </div>

            <div class="dropzone" id="dropzone">
                <svg viewBox="0 0 24 24"><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z"/></svg>
                <p>Tarik & lepas file PDF di sini, atau <strong>klik untuk memilih</strong></p>
                <p style="font-size: 0.85rem; color: var(--text-muted); margin-top: 0.5rem;">Mendukung banyak file sekaligus (Batch Processing)</p>
                <input type="file" id="fileInput" multiple accept=".pdf" style="display: none;">
            </div>

            <div class="file-list" id="fileList"></div>
            <button class="compress-btn" id="compressBtn" disabled>Kompres PDF Sekarang</button>
        </div>
    </div>

    <script>
        const dropzone = document.getElementById('dropzone');
        const fileInput = document.getElementById('fileInput');
        const fileList = document.getElementById('fileList');
        const compressBtn = document.getElementById('compressBtn');
        let filesArray = [];

        dropzone.addEventListener('click', () => fileInput.click());
        dropzone.addEventListener('dragover', (e) => { e.preventDefault(); dropzone.classList.add('dragover'); });
        dropzone.addEventListener('dragleave', () => dropzone.classList.remove('dragover'));
        dropzone.addEventListener('drop', (e) => { e.preventDefault(); dropzone.classList.remove('dragover'); handleFiles(e.dataTransfer.files); });
        fileInput.addEventListener('change', (e) => { handleFiles(e.target.files); fileInput.value = ''; });

        function handleFiles(files) {
            for (let file of files) {
                if (file.type === 'application/pdf') {
                    const isDuplicate = filesArray.some(f => f.name === file.name && f.size === file.size);
                    if (!isDuplicate) filesArray.push(file);
                } else {
                    alert(`Gagal: File "${file.name}" bukan berformat PDF!`);
                }
            }
            updateUI();
        }

        function removeFile(index) { filesArray.splice(index, 1); updateUI(); }
        function formatBytes(bytes, decimals = 2) {
            if (!+bytes) return '0 Bytes';
            const k = 1024, dm = decimals < 0 ? 0 : decimals, sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return `${parseFloat((bytes / Math.pow(k, i)).toFixed(dm))} ${sizes[i]}`;
        }

        function updateUI() {
            fileList.innerHTML = '';
            filesArray.forEach((file, index) => {
                const item = document.createElement('div');
                item.className = 'file-item';
                item.innerHTML = `
                    <div class="file-info">
                        <span class="file-name">${file.name}</span>
                        <span class="file-size">${formatBytes(file.size)}</span>
                    </div>
                    <button class="remove-btn" onclick="removeFile(${index})">Hapus</button>
                `;
                fileList.appendChild(item);
            });
            compressBtn.disabled = filesArray.length === 0;
        }

        compressBtn.addEventListener('click', async () => {
            const level = document.querySelector('input[name="level"]:checked').value;
            const maxMb = document.getElementById('maxMb').value;
            
            compressBtn.innerText = 'Mengunggah & Memproses...';
            compressBtn.disabled = true;

            const formData = new FormData();
            formData.append('level', level);
            if (maxMb) formData.append('maxMb', maxMb);
            filesArray.forEach(file => formData.append('file', file));

            try {
                const response = await fetch('/api/compress', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Gagal memproses PDF');
                }

                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                
                const contentDisposition = response.headers.get('Content-Disposition');
                let filename = 'compressed.pdf';
                if (contentDisposition && contentDisposition.includes('attachment')) {
                    const filenameMatch = contentDisposition.match(/filename="?([^"]+)"?/);
                    if (filenameMatch && filenameMatch.length === 2) filename = filenameMatch[1];
                }

                a.download = filename;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                a.remove();
                
                alert('Kompresi berhasil dan file mulai diunduh!');

            } catch (error) {
                console.error(error);
                alert('Terjadi kesalahan: ' + error.message);
            } finally {
                compressBtn.innerText = 'Kompres PDF Sekarang';
                compressBtn.disabled = false;
            }
        });
    </script>
</body>
</html>
